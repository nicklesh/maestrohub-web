{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":89,"index":89}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":90},"end":{"line":2,"column":69,"index":159}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"../services/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":160},"end":{"line":3,"column":38,"index":198}}],"key":"Pr5/EB33W7mJGi+ygccy+pUf1E8=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/src/context/MarketContext.tsx\";\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.MarketProvider = MarketProvider;\n  exports.useMarket = useMarket;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[1], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _servicesApi = require(_dependencyMap[2], \"../services/api\");\n  var _reactJsxDevRuntime = require(_dependencyMap[3], \"react/jsx-dev-runtime\");\n  const MarketContext = /*#__PURE__*/(0, _react.createContext)(undefined);\n  function MarketProvider({\n    children\n  }) {\n    const [markets, setMarkets] = (0, _react.useState)([]);\n    const [currentMarket, setCurrentMarket] = (0, _react.useState)(null);\n    const [needsSelection, setNeedsSelection] = (0, _react.useState)(false);\n    const [detectedCountry, setDetectedCountry] = (0, _react.useState)(null);\n    const [suggestedMarketId, setSuggestedMarketId] = (0, _react.useState)(null);\n    const [loading, setLoading] = (0, _react.useState)(true);\n    (0, _react.useEffect)(() => {\n      loadMarketData();\n    }, []);\n    const loadMarketData = async () => {\n      try {\n        // Load available markets\n        const marketsResponse = await _servicesApi.api.get('/markets');\n        setMarkets(marketsResponse.data.markets);\n\n        // Try to detect country from IP\n        try {\n          const geoResponse = await _servicesApi.api.get('/geo/detect');\n          setDetectedCountry(geoResponse.data.detected_country);\n          setSuggestedMarketId(geoResponse.data.suggested_market_id);\n        } catch (e) {\n          console.log('Geo detection not available');\n        }\n\n        // Check if user has a market set (if authenticated)\n        const token = await AsyncStorage.default.getItem('token');\n        if (token) {\n          try {\n            const marketResponse = await _servicesApi.api.get('/me/market');\n            if (marketResponse.data.market) {\n              setCurrentMarket(marketResponse.data.market);\n              setNeedsSelection(false);\n            } else {\n              setNeedsSelection(true);\n            }\n          } catch (e) {\n            // User not authenticated or no market set\n            setNeedsSelection(true);\n          }\n        } else {\n          // Check local storage for market preference\n          const storedMarketId = await AsyncStorage.default.getItem('selected_market_id');\n          if (storedMarketId && marketsResponse.data.markets) {\n            const found = marketsResponse.data.markets.find(m => m.market_id === storedMarketId);\n            if (found) {\n              setCurrentMarket(found);\n              setNeedsSelection(false);\n            } else {\n              setNeedsSelection(true);\n            }\n          } else {\n            setNeedsSelection(true);\n          }\n        }\n      } catch (error) {\n        console.error('Failed to load market data:', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n    const selectMarket = async marketId => {\n      try {\n        const market = markets.find(m => m.market_id === marketId);\n        if (!market) {\n          throw new Error('Invalid market');\n        }\n\n        // Save locally\n        await AsyncStorage.default.setItem('selected_market_id', marketId);\n        setCurrentMarket(market);\n        setNeedsSelection(false);\n\n        // Try to save to backend if authenticated\n        const token = await AsyncStorage.default.getItem('token');\n        if (token) {\n          try {\n            await _servicesApi.api.post('/me/market', {\n              market_id: marketId\n            });\n          } catch (e) {\n            // Silently fail - local storage is the fallback\n            console.log('Could not save market to server');\n          }\n        }\n      } catch (error) {\n        console.error('Failed to select market:', error);\n        throw error;\n      }\n    };\n    const refreshMarket = async () => {\n      setLoading(true);\n      await loadMarketData();\n    };\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(MarketContext.Provider, {\n      value: {\n        markets,\n        currentMarket,\n        needsSelection,\n        detectedCountry,\n        suggestedMarketId,\n        loading,\n        selectMarket,\n        refreshMarket\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 5\n    }, this);\n  }\n  function useMarket() {\n    const context = (0, _react.useContext)(MarketContext);\n    if (context === undefined) {\n      throw new Error('useMarket must be used within a MarketProvider');\n    }\n    return context;\n  }\n});","lineCount":142,"map":[[13,2,29,0,"exports"],[13,9,29,0],[13,10,29,0,"MarketProvider"],[13,24,29,0],[13,27,29,0,"MarketProvider"],[13,41,29,0],[14,2,146,0,"exports"],[14,9,146,0],[14,10,146,0,"useMarket"],[14,19,146,0],[14,22,146,0,"useMarket"],[14,31,146,0],[15,2,1,0],[15,6,1,0,"_react"],[15,12,1,0],[15,15,1,0,"require"],[15,22,1,0],[15,23,1,0,"_dependencyMap"],[15,37,1,0],[16,2,2,0],[16,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[16,42,2,0],[16,45,2,0,"require"],[16,52,2,0],[16,53,2,0,"_dependencyMap"],[16,67,2,0],[17,2,2,0],[17,6,2,0,"AsyncStorage"],[17,18,2,0],[17,21,2,0,"_interopDefault"],[17,36,2,0],[17,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[17,73,2,0],[18,2,3,0],[18,6,3,0,"_servicesApi"],[18,18,3,0],[18,21,3,0,"require"],[18,28,3,0],[18,29,3,0,"_dependencyMap"],[18,43,3,0],[19,2,3,38],[19,6,3,38,"_reactJsxDevRuntime"],[19,25,3,38],[19,28,3,38,"require"],[19,35,3,38],[19,36,3,38,"_dependencyMap"],[19,50,3,38],[20,2,27,0],[20,8,27,6,"MarketContext"],[20,21,27,19],[20,37,27,22],[20,41,27,22,"createContext"],[20,47,27,35],[20,48,27,35,"createContext"],[20,61,27,35],[20,63,27,67,"undefined"],[20,72,27,76],[20,73,27,77],[21,2,29,7],[21,11,29,16,"MarketProvider"],[21,25,29,30,"MarketProvider"],[21,26,29,31],[22,4,29,33,"children"],[23,2,29,67],[23,3,29,68],[23,5,29,70],[24,4,30,2],[24,10,30,8],[24,11,30,9,"markets"],[24,18,30,16],[24,20,30,18,"setMarkets"],[24,30,30,28],[24,31,30,29],[24,34,30,32],[24,38,30,32,"useState"],[24,44,30,40],[24,45,30,40,"useState"],[24,53,30,40],[24,55,30,51],[24,57,30,53],[24,58,30,54],[25,4,31,2],[25,10,31,8],[25,11,31,9,"currentMarket"],[25,24,31,22],[25,26,31,24,"setCurrentMarket"],[25,42,31,40],[25,43,31,41],[25,46,31,44],[25,50,31,44,"useState"],[25,56,31,52],[25,57,31,52,"useState"],[25,65,31,52],[25,67,31,68],[25,71,31,72],[25,72,31,73],[26,4,32,2],[26,10,32,8],[26,11,32,9,"needsSelection"],[26,25,32,23],[26,27,32,25,"setNeedsSelection"],[26,44,32,42],[26,45,32,43],[26,48,32,46],[26,52,32,46,"useState"],[26,58,32,54],[26,59,32,54,"useState"],[26,67,32,54],[26,69,32,55],[26,74,32,60],[26,75,32,61],[27,4,33,2],[27,10,33,8],[27,11,33,9,"detectedCountry"],[27,26,33,24],[27,28,33,26,"setDetectedCountry"],[27,46,33,44],[27,47,33,45],[27,50,33,48],[27,54,33,48,"useState"],[27,60,33,56],[27,61,33,56,"useState"],[27,69,33,56],[27,71,33,72],[27,75,33,76],[27,76,33,77],[28,4,34,2],[28,10,34,8],[28,11,34,9,"suggestedMarketId"],[28,28,34,26],[28,30,34,28,"setSuggestedMarketId"],[28,50,34,48],[28,51,34,49],[28,54,34,52],[28,58,34,52,"useState"],[28,64,34,60],[28,65,34,60,"useState"],[28,73,34,60],[28,75,34,76],[28,79,34,80],[28,80,34,81],[29,4,35,2],[29,10,35,8],[29,11,35,9,"loading"],[29,18,35,16],[29,20,35,18,"setLoading"],[29,30,35,28],[29,31,35,29],[29,34,35,32],[29,38,35,32,"useState"],[29,44,35,40],[29,45,35,40,"useState"],[29,53,35,40],[29,55,35,41],[29,59,35,45],[29,60,35,46],[30,4,37,2],[30,8,37,2,"useEffect"],[30,14,37,11],[30,15,37,11,"useEffect"],[30,24,37,11],[30,26,37,12],[30,32,37,18],[31,6,38,4,"loadMarketData"],[31,20,38,18],[31,21,38,19],[31,22,38,20],[32,4,39,2],[32,5,39,3],[32,7,39,5],[32,9,39,7],[32,10,39,8],[33,4,41,2],[33,10,41,8,"loadMarketData"],[33,24,41,22],[33,27,41,25],[33,33,41,25,"loadMarketData"],[33,34,41,25],[33,39,41,37],[34,6,42,4],[34,10,42,8],[35,8,43,6],[36,8,44,6],[36,14,44,12,"marketsResponse"],[36,29,44,27],[36,32,44,30],[36,38,44,36,"api"],[36,50,44,39],[36,51,44,39,"api"],[36,54,44,39],[36,55,44,40,"get"],[36,58,44,43],[36,59,44,44],[36,69,44,54],[36,70,44,55],[37,8,45,6,"setMarkets"],[37,18,45,16],[37,19,45,17,"marketsResponse"],[37,34,45,32],[37,35,45,33,"data"],[37,39,45,37],[37,40,45,38,"markets"],[37,47,45,45],[37,48,45,46],[39,8,47,6],[40,8,48,6],[40,12,48,10],[41,10,49,8],[41,16,49,14,"geoResponse"],[41,27,49,25],[41,30,49,28],[41,36,49,34,"api"],[41,48,49,37],[41,49,49,37,"api"],[41,52,49,37],[41,53,49,38,"get"],[41,56,49,41],[41,57,49,42],[41,70,49,55],[41,71,49,56],[42,10,50,8,"setDetectedCountry"],[42,28,50,26],[42,29,50,27,"geoResponse"],[42,40,50,38],[42,41,50,39,"data"],[42,45,50,43],[42,46,50,44,"detected_country"],[42,62,50,60],[42,63,50,61],[43,10,51,8,"setSuggestedMarketId"],[43,30,51,28],[43,31,51,29,"geoResponse"],[43,42,51,40],[43,43,51,41,"data"],[43,47,51,45],[43,48,51,46,"suggested_market_id"],[43,67,51,65],[43,68,51,66],[44,8,52,6],[44,9,52,7],[44,10,52,8],[44,17,52,15,"e"],[44,18,52,16],[44,20,52,18],[45,10,53,8,"console"],[45,17,53,15],[45,18,53,16,"log"],[45,21,53,19],[45,22,53,20],[45,51,53,49],[45,52,53,50],[46,8,54,6],[48,8,56,6],[49,8,57,6],[49,14,57,12,"token"],[49,19,57,17],[49,22,57,20],[49,28,57,26,"AsyncStorage"],[49,40,57,38],[49,41,57,38,"default"],[49,48,57,38],[49,49,57,39,"getItem"],[49,56,57,46],[49,57,57,47],[49,64,57,54],[49,65,57,55],[50,8,58,6],[50,12,58,10,"token"],[50,17,58,15],[50,19,58,17],[51,10,59,8],[51,14,59,12],[52,12,60,10],[52,18,60,16,"marketResponse"],[52,32,60,30],[52,35,60,33],[52,41,60,39,"api"],[52,53,60,42],[52,54,60,42,"api"],[52,57,60,42],[52,58,60,43,"get"],[52,61,60,46],[52,62,60,47],[52,74,60,59],[52,75,60,60],[53,12,61,10],[53,16,61,14,"marketResponse"],[53,30,61,28],[53,31,61,29,"data"],[53,35,61,33],[53,36,61,34,"market"],[53,42,61,40],[53,44,61,42],[54,14,62,12,"setCurrentMarket"],[54,30,62,28],[54,31,62,29,"marketResponse"],[54,45,62,43],[54,46,62,44,"data"],[54,50,62,48],[54,51,62,49,"market"],[54,57,62,55],[54,58,62,56],[55,14,63,12,"setNeedsSelection"],[55,31,63,29],[55,32,63,30],[55,37,63,35],[55,38,63,36],[56,12,64,10],[56,13,64,11],[56,19,64,17],[57,14,65,12,"setNeedsSelection"],[57,31,65,29],[57,32,65,30],[57,36,65,34],[57,37,65,35],[58,12,66,10],[59,10,67,8],[59,11,67,9],[59,12,67,10],[59,19,67,17,"e"],[59,20,67,18],[59,22,67,20],[60,12,68,10],[61,12,69,10,"setNeedsSelection"],[61,29,69,27],[61,30,69,28],[61,34,69,32],[61,35,69,33],[62,10,70,8],[63,8,71,6],[63,9,71,7],[63,15,71,13],[64,10,72,8],[65,10,73,8],[65,16,73,14,"storedMarketId"],[65,30,73,28],[65,33,73,31],[65,39,73,37,"AsyncStorage"],[65,51,73,49],[65,52,73,49,"default"],[65,59,73,49],[65,60,73,50,"getItem"],[65,67,73,57],[65,68,73,58],[65,88,73,78],[65,89,73,79],[66,10,74,8],[66,14,74,12,"storedMarketId"],[66,28,74,26],[66,32,74,30,"marketsResponse"],[66,47,74,45],[66,48,74,46,"data"],[66,52,74,50],[66,53,74,51,"markets"],[66,60,74,58],[66,62,74,60],[67,12,75,10],[67,18,75,16,"found"],[67,23,75,21],[67,26,75,24,"marketsResponse"],[67,41,75,39],[67,42,75,40,"data"],[67,46,75,44],[67,47,75,45,"markets"],[67,54,75,52],[67,55,75,53,"find"],[67,59,75,57],[67,60,76,13,"m"],[67,61,76,22],[67,65,76,27,"m"],[67,66,76,28],[67,67,76,29,"market_id"],[67,76,76,38],[67,81,76,43,"storedMarketId"],[67,95,77,10],[67,96,77,11],[68,12,78,10],[68,16,78,14,"found"],[68,21,78,19],[68,23,78,21],[69,14,79,12,"setCurrentMarket"],[69,30,79,28],[69,31,79,29,"found"],[69,36,79,34],[69,37,79,35],[70,14,80,12,"setNeedsSelection"],[70,31,80,29],[70,32,80,30],[70,37,80,35],[70,38,80,36],[71,12,81,10],[71,13,81,11],[71,19,81,17],[72,14,82,12,"setNeedsSelection"],[72,31,82,29],[72,32,82,30],[72,36,82,34],[72,37,82,35],[73,12,83,10],[74,10,84,8],[74,11,84,9],[74,17,84,15],[75,12,85,10,"setNeedsSelection"],[75,29,85,27],[75,30,85,28],[75,34,85,32],[75,35,85,33],[76,10,86,8],[77,8,87,6],[78,6,88,4],[78,7,88,5],[78,8,88,6],[78,15,88,13,"error"],[78,20,88,18],[78,22,88,20],[79,8,89,6,"console"],[79,15,89,13],[79,16,89,14,"error"],[79,21,89,19],[79,22,89,20],[79,51,89,49],[79,53,89,51,"error"],[79,58,89,56],[79,59,89,57],[80,6,90,4],[80,7,90,5],[80,16,90,14],[81,8,91,6,"setLoading"],[81,18,91,16],[81,19,91,17],[81,24,91,22],[81,25,91,23],[82,6,92,4],[83,4,93,2],[83,5,93,3],[84,4,95,2],[84,10,95,8,"selectMarket"],[84,22,95,20],[84,25,95,23],[84,31,95,30,"marketId"],[84,39,95,46],[84,43,95,51],[85,6,96,4],[85,10,96,8],[86,8,97,6],[86,14,97,12,"market"],[86,20,97,18],[86,23,97,21,"markets"],[86,30,97,28],[86,31,97,29,"find"],[86,35,97,33],[86,36,97,35,"m"],[86,37,97,36],[86,41,97,41,"m"],[86,42,97,42],[86,43,97,43,"market_id"],[86,52,97,52],[86,57,97,57,"marketId"],[86,65,97,65],[86,66,97,66],[87,8,98,6],[87,12,98,10],[87,13,98,11,"market"],[87,19,98,17],[87,21,98,19],[88,10,99,8],[88,16,99,14],[88,20,99,18,"Error"],[88,25,99,23],[88,26,99,24],[88,42,99,40],[88,43,99,41],[89,8,100,6],[91,8,102,6],[92,8,103,6],[92,14,103,12,"AsyncStorage"],[92,26,103,24],[92,27,103,24,"default"],[92,34,103,24],[92,35,103,25,"setItem"],[92,42,103,32],[92,43,103,33],[92,63,103,53],[92,65,103,55,"marketId"],[92,73,103,63],[92,74,103,64],[93,8,104,6,"setCurrentMarket"],[93,24,104,22],[93,25,104,23,"market"],[93,31,104,29],[93,32,104,30],[94,8,105,6,"setNeedsSelection"],[94,25,105,23],[94,26,105,24],[94,31,105,29],[94,32,105,30],[96,8,107,6],[97,8,108,6],[97,14,108,12,"token"],[97,19,108,17],[97,22,108,20],[97,28,108,26,"AsyncStorage"],[97,40,108,38],[97,41,108,38,"default"],[97,48,108,38],[97,49,108,39,"getItem"],[97,56,108,46],[97,57,108,47],[97,64,108,54],[97,65,108,55],[98,8,109,6],[98,12,109,10,"token"],[98,17,109,15],[98,19,109,17],[99,10,110,8],[99,14,110,12],[100,12,111,10],[100,18,111,16,"api"],[100,30,111,19],[100,31,111,19,"api"],[100,34,111,19],[100,35,111,20,"post"],[100,39,111,24],[100,40,111,25],[100,52,111,37],[100,54,111,39],[101,14,111,41,"market_id"],[101,23,111,50],[101,25,111,52,"marketId"],[102,12,111,61],[102,13,111,62],[102,14,111,63],[103,10,112,8],[103,11,112,9],[103,12,112,10],[103,19,112,17,"e"],[103,20,112,18],[103,22,112,20],[104,12,113,10],[105,12,114,10,"console"],[105,19,114,17],[105,20,114,18,"log"],[105,23,114,21],[105,24,114,22],[105,57,114,55],[105,58,114,56],[106,10,115,8],[107,8,116,6],[108,6,117,4],[108,7,117,5],[108,8,117,6],[108,15,117,13,"error"],[108,20,117,18],[108,22,117,20],[109,8,118,6,"console"],[109,15,118,13],[109,16,118,14,"error"],[109,21,118,19],[109,22,118,20],[109,48,118,46],[109,50,118,48,"error"],[109,55,118,53],[109,56,118,54],[110,8,119,6],[110,14,119,12,"error"],[110,19,119,17],[111,6,120,4],[112,4,121,2],[112,5,121,3],[113,4,123,2],[113,10,123,8,"refreshMarket"],[113,23,123,21],[113,26,123,24],[113,32,123,24,"refreshMarket"],[113,33,123,24],[113,38,123,36],[114,6,124,4,"setLoading"],[114,16,124,14],[114,17,124,15],[114,21,124,19],[114,22,124,20],[115,6,125,4],[115,12,125,10,"loadMarketData"],[115,26,125,24],[115,27,125,25],[115,28,125,26],[116,4,126,2],[116,5,126,3],[117,4,128,2],[117,24,129,4],[117,28,129,4,"_reactJsxDevRuntime"],[117,47,129,4],[117,48,129,4,"jsxDEV"],[117,54,129,4],[117,56,129,5,"MarketContext"],[117,69,129,18],[117,70,129,19,"Provider"],[117,78,129,27],[118,6,130,6,"value"],[118,11,130,11],[118,13,130,13],[119,8,131,8,"markets"],[119,15,131,15],[120,8,132,8,"currentMarket"],[120,21,132,21],[121,8,133,8,"needsSelection"],[121,22,133,22],[122,8,134,8,"detectedCountry"],[122,23,134,23],[123,8,135,8,"suggestedMarketId"],[123,25,135,25],[124,8,136,8,"loading"],[124,15,136,15],[125,8,137,8,"selectMarket"],[125,20,137,20],[126,8,138,8,"refreshMarket"],[127,6,139,6],[127,7,139,8],[128,6,139,8,"children"],[128,14,139,8],[128,16,141,7,"children"],[129,4,141,15],[130,6,141,15,"fileName"],[130,14,141,15],[130,16,141,15,"_jsxFileName"],[130,28,141,15],[131,6,141,15,"lineNumber"],[131,16,141,15],[132,6,141,15,"columnNumber"],[132,18,141,15],[133,4,141,15],[133,11,142,28],[133,12,142,29],[134,2,144,0],[135,2,146,7],[135,11,146,16,"useMarket"],[135,20,146,25,"useMarket"],[135,21,146,25],[135,23,146,28],[136,4,147,2],[136,10,147,8,"context"],[136,17,147,15],[136,20,147,18],[136,24,147,18,"useContext"],[136,30,147,28],[136,31,147,28,"useContext"],[136,41,147,28],[136,43,147,29,"MarketContext"],[136,56,147,42],[136,57,147,43],[137,4,148,2],[137,8,148,6,"context"],[137,15,148,13],[137,20,148,18,"undefined"],[137,29,148,27],[137,31,148,29],[138,6,149,4],[138,12,149,10],[138,16,149,14,"Error"],[138,21,149,19],[138,22,149,20],[138,70,149,68],[138,71,149,69],[139,4,150,2],[140,4,151,2],[140,11,151,9,"context"],[140,18,151,16],[141,2,152,0],[142,0,152,1],[142,3]],"functionMap":{"names":["<global>","MarketProvider","useEffect$argument_0","loadMarketData","marketsResponse.data.markets.find$argument_0","selectMarket","markets.find$argument_0","refreshMarket","useMarket"],"mappings":"AAA;OC4B;YCQ;GDE;yBEE;YCmC,6CD;GFiB;uBIE;kCCE,+BD;GJwB;wBME;GNG;CDkB;OQE;CRM"},"hasCjsExports":false},"type":"js/module"}]}